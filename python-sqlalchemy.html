<!DOCTYPE html>

<html>
   <head>
   
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="highlight/styles/github.css">
      <link rel="stylesheet" href="css/style.css">
      <script src="highlight/highlight.pack.js"></script>
      <script>
         $(document).ready(function(){
            $('pre.code').each(function(i, block) {
               hljs.highlightBlock(block);
            }); 
         });
      </script> 
   </head>

   <body>
      <div class="container">
         <div class="jumbotron" style="background-color:white">
            <h1>Sqlalchemy Cheat Sheet</h1>
            <p>Cheat sheet of Python. Some basic concept for Python programmer need to know.</p>
         </div>
         <div class="row">
            <div class="col-sm-4">
<h3>Sqlalchemy Support DBAPI - PEP249</h3>
<pre class="code python">
from sqlalchemy import create_engine 

db_uri = "sqlite:///db.sqlite"
engine = create_engine(db_uri)

# DBAPI - PEP249
# create table
engine.execute('CREATE TABLE "EX1" ('
               'id INTEGER NOT NULL,' 
               'name VARCHAR, '
               'PRIMARY KEY (id)'
               ');')
# insert a raw
engine.execute('INSERT INTO "EX1" '
               '(id, name) '
               'VALUES (1,"raw1")')

# select *
result = engine.execute('SELECT * FROM '
                        '"EX1"')
for _r in result:
   print _r

# delete *
engine.execute('DELETE from "EX1"'
               'where id=1;')
result = engine.execute('SELECT * FROM '
                        '"EX1"')
print result.fetchall()

# bash&gt; python ex.py
# (1, u'raw1')
# []
</pre>
<h3>Transaction and Connect Object</h3>
<pre class="code python">
from sqlalchemy import create_engine

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)

# Create connection
conn = engine.connect()
# Begin transaction
trans = conn.begin()
conn.execute('INSERT INTO "EX1" (name) '
             'VALUES ("Hello")')
trans.commit()
# Close connection
conn.close()
</pre>

<h3>Metadata - Generating Database Schema</h3>
<pre class="code python">
from sqlalchemy import create_engine
from sqlalchemy import MetaData
from sqlalchemy import Table
from sqlalchemy import Column
from sqlalchemy import Integer, String

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)

# Create a metadata instance
metadata = MetaData(engine)
# Declare a table
table = Table('Example',metadata,
              Column('id',Integer,
                     primary_key=True),
              Column('name',String))
# Create all tables
metadata.create_all()
for _t in metadata.tables:
   print "Table: ", _t

# bash&gt; ex.py
# Table:  Example
</pre>
<h3>Reflection - Loading Table from Existing Database</h3>
<pre class="code python">
from sqlalchemy import create_engine
from sqlalchemy import MetaData
from sqlalchemy import Table 

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)

# Create a MetaData instance
metadata = MetaData()
print metadata.tables

# reflect db schema to MetaData
metadata.reflect(bind=engine)
print metadata.tables
</pre>

<h3>Get Table from MetaData</h3>
<pre class="code python">
from sqlalchemy import create_engine
from sqlalchemy import MetaData
from sqlalchemy import Table

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)

# Create MetaData instance
metadata = MetaData(engine, reflect=True)
print metadata.tables

# Get Table
ex_table = metadata.tables['Example'] 
print ex_table
</pre>
<h3>Create all Tables Store in "MetaData"</h3>
<pre class="code python">
from sqlalchemy import create_engine
from sqlalchemy import MetaData
from sqlalchemy import Table
from sqlalchemy import Column
from sqlalchemy import Integer, String

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)
meta = MetaData(engine)

# Register t1, t2 to metadata
t1 = Table('EX1', meta,
           Column('id',Integer,
                   primary_key=True),
           Column('name',String))

t2 = Table('EX2', meta,
           Column('id',Integer,
                   primary_key=True),
           Column('val',Integer))
# Create all tables in meta
meta.create_all()

# bash&gt; sqlite3 db.sqlite
# sqlite &gt; .schema
# CREATE TABLE "EX1" (
# 	 id INTEGER NOT NULL, 
#	 name VARCHAR, 
#	 PRIMARY KEY (id)
# );
# CREATE TABLE "EX2" (
#	 id INTEGER NOT NULL, 
#	 val INTEGER, 
#	 PRIMARY KEY (id)
# );
</pre>
<h3>Create Specific Table</h3>
<pre class="code python">
from sqlalchemy import create_engine
from sqlalchemy import MetaData
from sqlalchemy import Table
from sqlalchemy import Column
from sqlalchemy import Integer, String

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)

meta = MetaData(engine)
t1 = Table('Table_1', meta,
           Column('id', Integer, 
                  primary_key=True),
           Column('name',String))
t2 = Table('Table_2', meta,
           Column('id', Integer,
                  primary_key=True),
           Column('val',Integer))
t1.create()

# bash&gt; sqlite3 db.sqlite
# sqlite&gt; .schema
# CREATE TABLE "Table_1" (
# 	 id INTEGER NOT NULL, 
#	 name VARCHAR, 
#	 PRIMARY KEY (id)
# );
</pre>
<h3>Some Table Object Operation</h3>
<pre class="code python">
from sqlalchemy import MetaData
from sqlalchemy import Table
from sqlalchemy import Column
from sqlalchemy import Integer, String

meta = MetaData()
t = Table('ex_table', meta,
          Column('id', Integer,
                 primary_key=True),
          Column('key', String),
          Column('val', Integer))
# Get Table Name
print t.name

# Get Columns
print t.columns.keys()

# Get Column
c = t.c.key
print c.name
# Or
c = t.columns.key
print c.name

# Get Table from Column
print c.table
# bash&gt; python ex.py
# ex_table
# ['id', 'key', 'val']
# key
# key
# ex_table
</pre>
             </div>
            <div class="col-sm-4">
<h3>Inspect - Get Database Information</h3>
<pre class="code python">
from sqlalchemy import create_engine
from sqlalchemy import inspect

db_uri = 'sqlite:///db.sqlite'
engine = create_engine(db_uri)

inspector = inspect(engine)

# Get table information
print inspector.get_table_names()

# Get column information
print inspector.get_columns('EX1')
</pre>

<h3>SQL Expression Language</h3>
<pre class="code python">
# Think Column as "ColumnElement"
# Implement via overwrite special function
from sqlalchemy import MetaData
from sqlalchemy import Table
from sqlalchemy import Column
from sqlalchemy import Integer, String

meta = MetaData()
table = Table('example', meta,
              Column('id', Integer,
                 primary_key=True),
              Column('l_name', String),
              Column('f_name', String))

# sql expression binary object 
print repr(table.c.l_name == 'ed')
# exhbit sql expression
print str(table.c.l_name == 'ed')

print repr(table.c.f_name != 'ed')
print str(table.c.f_name != 'ed')

print repr(table.c.id &gt; 3)
print str(table.c.id &gt; 3)

# bash&gt; python ex.py
# &lt;sqlalchemy.sql.elements.Binary...
# example.l_name = :l_name_1
# &lt;sqlalchemy.sql.elements.Binary...
# example.f_name != :f_name_1
# &lt;sqlalchemy.sql.elements.Binary...
# example.id > :id_1
</pre>

            </div>
            <div class="col-sm-4">
               <h3>Test</h3>
            </div>
         </div>
      </div>
   </body>

</html>
