<!DOCTYPE html>

<html>
   <head>
   
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
      <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
      <link rel="stylesheet" href="highlight/styles/github.css">
      <link rel="stylesheet" href="css/style.css">
      <script src="highlight/highlight.pack.js"></script>
      <script>
         $(document).ready(function(){
            $('pre.code').each(function(i, block) {
               hljs.highlightBlock(block);
            }); 
         });
      </script> 
   </head>

   <body>
      <div class="container">
         <div class="jumbotron" style="background:white;">
            <h1>Python Cheat Sheet</h1>
            <p>Cheat sheet of Python. Common scenarios for Python programmers.</p>
         </div>
         <div class="row">
            <div class="col-sm-4">

<h3>Get information about exception</h3>
<pre class="code python">
# get:
# - exception type
# - exception parameter
# - traceback object
&gt;&gt;&gt; import sys
&gt;&gt;&gt; try:
...   1/0
... except Exception as e:
...   print sys.exc_info()
... 
(&lt;type 'exceptions.ZeroDivisionError'&gt;, ZeroDivisionError('integer division or modulo by zero',), &lt;traceback object at 0x1034cf440&gt;)
</pre>

<h3>Basic traceback exception</h3>
<pre class="code python">
# see: python document - traceback
&gt;&gt;&gt; import traceback
&gt;&gt;&gt; try:
...   1/0
... except:
...   exc_info = sys.exc_info()
...   print '---- traceback ----'
...   traceback.print_tb(exc_info[2])
...   print '---- exception ----'
...   traceback.print_exception(*exc_info)
... 
---- traceback ----
  File "&lt;stdin&gt;", line 2, in &lt;module&gt;
---- exception ----
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 2, in &lt;module&gt;
ZeroDivisionError: integer division or modulo by zero
</pre>

<h3>High-Level "print" - logging</h3>
<pre class="code python">
# see: python document-Logging HOWTO
# 1. "print" message when you need.
# 
# 2. There are 5 different "level"
# - DEBUG (lowest)
# - INFO
# - WARNING (default level)
# - ERROR
# - CIRITICAL (highest - like "print")
# to determine whether to "print" message.
#
# 3. If "print level" is higher than a programmer set, it will print the message in runtime. 

# default level: warning
&gt;&gt;&gt; import logging
&gt;&gt;&gt; logging.debug("debug")
&gt;&gt;&gt; logging.info("info")
&gt;&gt;&gt; logging.warning("warning")
WARNING:root:warning
&gt;&gt;&gt; logging.error("error")
ERROR:root:error
&gt;&gt;&gt; logging.critical("cirtical")
CRITICAL:root:cirtical

# set up level: debug
&gt;&gt;&gt; logging.basicConfig(
...   level =logging.DEBUG
... )
&gt;&gt;&gt; logging.debug("debug")
DEBUG:root:debug
&gt;&gt;&gt; logging.info("info")
INFO:root:info
&gt;&gt;&gt; logging.warning("warning")
WARNING:root:warning
&gt;&gt;&gt; logging.error("error")
ERROR:root:error
&gt;&gt;&gt; logging.critical("cirtical")
CRITICAL:root:cirtical

# log to a file(raw data)
&gt;&gt;&gt; logging.basicConfig(
...   filename='example.log',
...   level=logging.DEBUG
... )

# display with format with date
&gt;&gt;&gt; logging.basicConfig(
...   format='%(asctime)s: %(message)s',
...   datefmt='%m/%d/%Y %I:%M:%S %p'
... )
&gt;&gt;&gt; logging.warning("warning")
03/16/2015 10:46:35 PM: warning

# logger object
&gt;&gt;&gt; logger = logging.getLogger(__name__)
&gt;&gt;&gt; logger.setLevel(logging.DEBUG)
&gt;&gt;&gt; logger.info('info')
INFO:__main__:info
# set logger level
&gt;&gt;&gt; logger.setLevel(logging.ERROR)
&gt;&gt;&gt; logger.info('info')
</pre>

<h3>Calculate time cost of a function</h3>
<pre class="code python">
import time
def CalTime(func):
   def wrapper(*args, **kwargs):
      s = time.time()
      func(*args, **kwargs)
      e = time.time()
      print "Cost time: {0}".format(e-s)
   return wrapper
      
@CalTime
def example(n):
   time.sleep(n)

@CalTime
def exLoop():
   for _ in range(10000):
      pass

if __name__ == '__main__':
   example(5)
   exLoop()
</pre>

<h3>Profiling - How efficiency of a function</h3>
<pre class="code python">
import cProfile, pstats

def Profiling(func):
   def wrapper(*args, **kwargs):
      pr=cProfile.Profile()
      pr.enable()
      func(*args, **kwargs)
      pr.disable()
      ps = pstats.Stats(pr)
      ps.print_stats()
   return wrapper

@Profiling
def example(n):
   import time
   time.sleep(n)

@Profiling
def exLoop():
   for _ in range(10000):
      pass

if __name__ == '__main__':
   example(5)
   exLoop()
</pre>

            </div>
            <div class="col-sm-4">
<h3>Handle json data</h3>
<pre class="code python">
&gt;&gt;&gt; pydict = {"1":1,"2":[1,2,3]}
import json

# python obj to json string
&gt;&gt;&gt; jstr=json.dumps(pydict)
&gt;&gt;&gt; jstr
'{"1": 1, "2": [1, 2, 3]}'

# json string to python obj
&gt;&gt;&gt; pyobj = json.loads(jstr)
&gt;&gt;&gt; pyobj
{u'1': 1, u'2': [1, 2, 3]}

# read json from file
with open('ex.json') as fd:
&gt;&gt;&gt; with open('ex.json') as fd:
...   pyobj = json.load(fd)
...   print pyobj
... 
{u'1': 1, u'2': [1, 2, 3]}
# write json to file with indent
&gt;&gt;&gt; with open('ex.json','w') as fd:
...   pyobj = {"1":1, "2":[1, 2]}
...   json.load(pyobj,fd,indent=4)
...
</pre>
<h3>Handle yaml data</h3>
<pre class="code python">
# need to install PyYAML first
# see: http://pyyaml.org/
&gt;&gt;&gt; pyobj = {'a': 1, 'b': [1, 2, 3]}
&gt;&gt;&gt; import yaml

# python obj to yaml string
&gt;&gt;&gt; yaml.dump(pyobj)
'a: 1\nb: [1, 2, 3]\n'

# yaml string to python obj
&gt;&gt;&gt; yaml.load("""
... a: 1
... b: [1,2,3]
... """)
{'a': 1, 'b': [1, 2, 3]}

# read yaml from file
&gt;&gt;&gt; with open('ex.yaml') as fd:
...   pyobj = yaml.load(fd)
...   print pyobj
... 
{'a': 1, 'b': ['ex1', 123]}

# write yaml to file
&gt;&gt;&gt; import yaml
&gt;&gt;&gt; with open('ex.yaml','w') as fd:
...   yaml.dump(pyobj,fd)
...
</pre>
<h3>Handle ini format</h3>
<pre class="code python">
# ini is not convenient for list or dict
# only "key value" is more suitable 
# see: python document - ConfigParser
&gt;&gt;&gt; from ConfigParser import ConfigParser
&gt;&gt;&gt; def iniLoad(fp):
...   parser = ConfigParser()
...   parser.readfp(fp)
...   sect = parser.sections()
...   dict_ = {}
...   for s in sect:
...     dict_[s] = dict(parser.items(s))
...   return dict_
... 
&gt;&gt;&gt; def iniDump(ini,fp):
...   parser = ConfigParser()
...   for _s in ini:
...     parser.add_section(_s)
...     for _ in ini[_s].items():
...       parser.set(_s,_[0],_[1])
...   parser.write(fp)
...

# read from string
&gt;&gt;&gt; ini = """
... [section]
... a = a
... key = val
... """
&gt;&gt;&gt; import io
&gt;&gt;&gt; iniLoad(io.BytesIO(ini))
{'section': {'a': 'a', 'key': 'val'}} 

# read from file
&gt;&gt;&gt; with open('ex.ini') as fp:
...   ini = iniLoad(fp)
...   print ini
... 
{'section': {'num': '1', 'key': 'value'}}

# write to file
&gt;&gt;&gt; ini={'section':{'num':'1'}}
&gt;&gt;&gt; with open('ex.ini','w') as fp:
...   iniDump(ini,fp)
...
</pre>

<h3>TAR files</h3>
<pre class="code python">
# see: python document - tarfile
# Before start, I prepare two dd file
# dd if=/dev/zero of=ex.dd bs=1m count=100
&gt;&gt;&gt; import tarfile
&gt;&gt;&gt; tar=tarfile.open('ex.tar','w')
&gt;&gt;&gt; tar.add('ex.dd')
&gt;&gt;&gt; tar.add('ex.dd2')
&gt;&gt;&gt; tar.close()

# tar files with gzip
&gt;&gt;&gt; tar=tarfile.open('ex.tar.gz','w|gz')
&gt;&gt;&gt; tar.add('ex.dd')
&gt;&gt;&gt; tar.add('ex.dd2')
&gt;&gt;&gt; tar.close()

# tar files with bzip2
&gt;&gt;&gt; tar=tarfile.open('ex.tar.bz2','w|bz2')
&gt;&gt;&gt; tar.add('ex.dd')
&gt;&gt;&gt; tar.add('ex.dd2')
&gt;&gt;&gt; tar.close()

# check tar info
&gt;&gt;&gt; tar = tarfile.open('ex.tar.bz2','r')
# print a table of contents to sys.stdout
&gt;&gt;&gt; tar.list()
-rw-r--r-- ... 2015-03-22 10:15:50 ex.dd
-rw-r--r-- ... 2015-03-22 10:24:40 ex.dd2
# get tarball path 
&gt;&gt;&gt; tar.name
'/Users/apple/ex.tar.bz2'
# get tarbal files name
&gt;&gt;&gt; tar.getnames()
['ex.dd', 'ex.dd2']
# TarInfo object for member name.
&gt;&gt;&gt; tar.members
[&lt;TarInfo 'ex.dd' at 0x1034c6fd0&gt;, 
&lt;TarInfo 'ex.dd2' at 0x1034bcc90&gt;]

# extract all member in tarball
&gt;&gt;&gt; tar.extractall()
</pre>

            </div>
            <div class="col-sm-4">
<h3>Check file exists</h3>
<pre class="code python">
&gt;&gt;&gt; import os
&gt;&gt;&gt; os.path.exists('/usr/local')
True
</pre>

<h3>Check is directory or file</h3>
<pre class="code python">
import os
&gt;&gt;&gt; os.path.isdir('/usr/local')
True
&gt;&gt;&gt; os.path.isfile('/usr/local')
False
&gt;&gt;&gt; os.path.isfile('/usr/local/bin/node')
True
</pre>
<h3>Get all files from specific directory</h3>
<pre class="code python">
import os
# print dirpath, dirname, filename
&gt;&gt;&gt; for d, dn, fn in os.walk('./ex'):
...   print d, dn, fn
... 
./ex ['dir'] ['ex1', 'ex2']
./ex/dir [] []
</pre>

<h3>Other common path related operation</h3>
<pre class="code python">
import os
# get current dir
&gt;&gt;&gt; os.getcwd()
'/Users/apple'

# change current dir
&gt;&gt;&gt; os.chdir('/usr/local')
&gt;&gt;&gt; os.getcwd()
'/usr/local'

# get path dirname
&gt;&gt;&gt; os.path.dirname('/usr/local/bin')
'/usr/local'

# get path basename
&gt;&gt;&gt; os.path.basename('/usr/loca/bin/node')
'node'
&gt;&gt;&gt; os.path.basename('/usr/local/')
''
&gt;&gt;&gt; os.path.basename('/usr/local')
'local'

# check path is absolute path
&gt;&gt;&gt; os.path.isabs('./')
False
&gt;&gt;&gt; os.path.isabs('/')
True

# get module current path
&gt;&gt;&gt; os.__file__
'/System/Library/.../python2.7/os.pyc'

# get related path
&gt;&gt;&gt; os.path.relpath('/usr/local')
'../../usr/local'

# get absolute path
&gt;&gt;&gt; os.path.abspath('./')
'/Users/apple'

# join path
&gt;&gt;&gt; os.path.join('/usr/local/','bin')
'/usr/local/bin'
&gt;&gt;&gt; os.path.join('/usr/local/','bin')
'/usr/local/bin'

# split path into ('dirname', 'basename')
&gt;&gt;&gt; os.path.split('/usr/local/bin')
('/usr/local', 'bin')
&gt;&gt;&gt; os.path.split('/usr/local/bin/')
('/usr/local/bin', '')
</pre>

<h3>Call Shell command</h3>
<pre class="code python">
&gt;&gt;&gt; import subprocess
&gt;&gt;&gt; cmd = 'ls ex'
&gt;&gt;&gt; ret = subprocess.call(cmd.split())
dir ex1 ex2
&gt;&gt;&gt; ret
0
# raise CalledProcessError if return code is not zero
&gt;&gt;&gt; cmd = 'ls ex'
&gt;&gt;&gt; subprocess.check_call(cmd.split())
dir ex1 ex2
0
&gt;&gt;&gt; cmd = 'l ex'
&gt;&gt;&gt; subprocess.check_call(cmd.split())
Traceback (most recent call last):
...
raise child_exception
OSError: [Errno 2] ...

# get output result 
&gt;&gt;&gt; cmd = 'echo "hi"'.split()
&gt;&gt;&gt; res = subprocess.check_output(cmd)
&gt;&gt;&gt; res
'"hi"\n'
</pre>

<h3>Get platform info</h3>
<pre class="code python">
# see: python document - platform 
&gt;&gt;&gt; import platform
# get platform information
&gt;&gt;&gt; platform.platform()
'Darwin-13.4.0-x86_64-i386-64bit'

# get processor info 
&gt;&gt;&gt; platform.processor()
'i386'

# get system/os name
&gt;&gt;&gt; platform.system()
'Darwin'

# get uname info
&gt;&gt;&gt; platform.uname()
('Darwin', 'MacBookPro-4358.local', '13.4.0', 'Darwin Kernel Version 13.4.0: Sun Aug 17 19:50:11 PDT 2014; root:xnu-2422.115.4~1/RELEASE_X86_64', 'x86_64', 'i386')
</pre>

            </div>
         </div>
         <div class="row">
            <div class="col-sm-6">
<h3>SQLAlchemy - Object Relational Mapping(ORM)</h3>
<pre class="code python">
# converting data between object 
# interact without database without sql.
# see: http://www.sqlalchemy.org/
# step1 - connecting to database
&gt;&gt;&gt; from sqlalchemy import create_engine
&gt;&gt;&gt; engine = create_engine('sqlite:///example.db')

# step2 - declare object(table)
&gt;&gt;&gt; from sqlalchemy.ext.declarative import declarative_base
&gt;&gt;&gt; Base = declarative_base()
&gt;&gt;&gt; from sqlalchemy import Column, Integer, String, DateTime
# import generic functions
&gt;&gt;&gt; from sqlalchemy import func
&gt;&gt;&gt; class exTable(Base):
...   __tablename__ = 'extable'
...   id = Column(Integer, primary_key=True)
...   intcol = Column(Integer)
...   strcol = Column(String(8))
...   datecol = Column(DateTime, default=func.localtimestamp())
... 

# step3 - create schema(table) 
&gt;&gt;&gt; Base.metadata.create_all(engine)

# step4 - create a session(ORM talk to database by session) 
&gt;&gt;&gt; from sqlalchemy.orm import sessionmaker
&gt;&gt;&gt; smaker = sessionmaker(bind=engine)
&gt;&gt;&gt; ex = exTable(intcol=1, strcol="ex")
&gt;&gt;&gt; session = smaker()
&gt;&gt;&gt; session.add(ex)
# commit all change into datebase
&gt;&gt;&gt; session.commit()
&gt;&gt;&gt; session.close()
</pre>
            </div>
            <div class="col-sm-6">

            </div>
         </div>
      </div>
   </body>

</html>
